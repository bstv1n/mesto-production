(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"3e8e5122-92ee-4307-9f1a-620116c4d339","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ie=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),K=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),ue=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(u),de=(e,t)=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(u),pe=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(u),me=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(o=>u(o)),_e=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(u);function x(e){document.querySelectorAll(e.formSelector).forEach(o=>{fe(o,e)})}function M(e,t){const o=e.querySelector(t.submitButtonSelector);G(o,t),e.querySelectorAll(t.inputSelector).forEach(n=>{const s=e.querySelector(`#${n.id}-error`);s.textContent="",P(n,s,t.inputErrorClass,t.errorClass)})}function fe(e,t){const o=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{const s=e.querySelector(`#${n.id}-error`);n.addEventListener("input",()=>{n.value===""&&P(n,s,t.inputErrorClass,t.errorClass),n.type=="url"?O(n,s,ve,t):O(n,s,Se,t),ye(e,r,t)})})}function O(e,t,o,r){return e.validity.valid?(P(e,t,r.inputErrorClass,r.errorClass),!0):(o(e.validity)?N(e,t,e.dataset.errorMessage,r.inputErrorClass,r.errorClass):N(e,t,e.validationMessage,r.inputErrorClass,r.errorClass),!1)}function ye(e,t,o){e.checkValidity()?he(t,o):G(t,o)}function G(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function he(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function N(e,t,o,r,n){e.classList.add(r),t.textContent=o,t.classList.add(n)}function P(e,t,o,r){e.classList.remove(o),t.textContent="",t.classList.remove(r)}function Se(e){return e.patternMismatch||e.tooShort||e.tooLong}function ve(e){return e.typeMismatch}const Ce=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),Q=(e,t,o,{onPreviewPicture:r,onLikeIcon:n,onDeleteCard:s,onInfoClick:d})=>{const l=Ce(),E=l.querySelector(".card__like-button"),D=l.querySelector(".card__control-button_type_delete"),ce=l.querySelector(".card__control-button_type_info"),b=l.querySelector(".card__image"),le=l.querySelector(".card__like-count"),k=t._id,ae=t.owner._id,A=t.likes.length;return ae!==o&&(D.style.display="none"),le.textContent=A>0?A:"",e&&E.classList.add("card__like-button_is-active"),b.src=t.link,b.alt=t.name,l.querySelector(".card__title").textContent=t.name,n&&E.addEventListener("click",()=>n(E,k)),s&&D.addEventListener("click",()=>s(l,k)),d&&ce.addEventListener("click",()=>d(k)),r&&b.addEventListener("click",()=>r({name:t.name,link:t.link})),l},X=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",X)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",X)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})},Z=document.querySelector(".places__list"),B=document.querySelector(".popup_type_edit"),h=B.querySelector(".popup__form"),ee=h.querySelector(".popup__input_type_name"),te=h.querySelector(".popup__input_type_description"),W=h.querySelector(".button"),C=document.querySelector(".popup_type_new-card"),f=C.querySelector(".popup__form"),Le=f.querySelector(".popup__input_type_card-name"),qe=f.querySelector(".popup__input_type_url"),V=C.querySelector(".button"),T=document.querySelector(".popup_type_image"),H=T.querySelector(".popup__image"),Ee=T.querySelector(".popup__caption"),be=document.querySelector(".profile__edit-button"),ke=document.querySelector(".profile__add-button"),U=document.querySelector(".profile__title"),F=document.querySelector(".profile__description"),$=document.querySelector(".profile__image"),L=document.querySelector(".popup_type_remove-card"),ge=L.querySelector(".popup__form"),j=L.querySelector(".popup__button"),q=document.querySelector(".popup_type_edit-avatar"),y=q.querySelector(".popup__form"),Ie=y.querySelector(".popup__input"),J=y.querySelector(".button"),_=document.querySelector(".popup_type_info"),we=_.querySelector(".popup__title"),S=_.querySelector(".popup__info"),R=_.querySelector(".popup__list"),z=_.querySelector(".popup__text");let v="";const p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let I=null,w=null;const i=(e,t,o)=>{t?(e.textContent=o+"...",e.disabled=!0):(e.textContent=o,e.disabled=!1)},xe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),Me=()=>document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0),Pe=()=>document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0),g=(e,t)=>{const o=Me();return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Be=e=>{const t=Pe();return t.textContent=e.name,t.style.backgroundImage=`url(${e.avatar})`,t.title=e.name,t},oe=e=>{S.innerHTML="",R.innerHTML="",K().then(t=>{const o=t.find(r=>r._id===e);if(!o)throw new Error("Карточка не найдена");we.textContent=o.name,S.append(g("Дата создания:",xe(new Date(o.createdAt)))),S.append(g("Количество лайков:",o.likes.length.toString())),S.append(g("Автор:",o.owner.name)),o.likes.length>0?(z.textContent="Понравилось:",o.likes.forEach(r=>{R.append(Be(r))})):z.textContent="Пока нет лайков",m(_)}).catch(t=>{console.log("Ошибка при получении информации о карточке:",t),alert("Не удалось загрузить информацию о карточке")})},re=(e,t)=>{const o=e.classList.contains("card__like-button_is-active");me(t,o).then(r=>{e.classList.toggle("card__like-button_is-active");const n=e.closest(".card__likes").querySelector(".card__like-count");n.textContent=r.likes.length>0?r.likes.length:""}).catch(r=>{console.error("Ошибка при изменении лайка:",r)})},ne=(e,t)=>{w=e,I=t,m(L)},Te=e=>{e.preventDefault(),i(j,!0,"Удаление"),_e(I).then(()=>{w.remove(),a(L),w=null,I=null}).catch(t=>{console.error("Ошибка при удалении карточки:",t),alert("Не удалось удалить карточку. Попробуйте еще раз.")}).finally(()=>{i(j,!1,"Удаление")})},se=({name:e,link:t})=>{H.src=t,H.alt=e,Ee.textContent=e,m(T)},Ue=e=>{e.preventDefault(),i(W,!0,"Сохранение");const t=ee.value,o=te.value;pe({name:t,about:o}).then(r=>{U.textContent=r.name,F.textContent=r.about,a(B)}).catch(r=>{console.log("Ошибка при обновлении профиля:",r)}).finally(()=>{i(W,!1,"Сохранение"),a(q)})},Fe=e=>{e.preventDefault(),i(J,!0,"Сохранение"),ue(Ie.value).then(t=>{$.style.backgroundImage=`url(${t.avatar})`}).catch(t=>{console.error("Ошибка при обновлении аватара:",t),alert("Не удалось обновить аватар. Попробуйте еще раз.")}).finally(()=>{i(J,!1,"Сохранение"),a(q)})},$e=e=>{e.preventDefault(),i(V,!0,"Создание"),de(Le.value,qe.value).then(t=>{Z.prepend(Q(!1,{name:t.name,link:t.link,_id:t._id,likes:t.likes,owner:t.owner},v,{onPreviewPicture:se,onLikeIcon:re,onDeleteCard:ne,onInfoClick:oe}))}).catch(t=>{console.error("Ошибка при создании карточки:",t),alert("Не удалось создать карточку. Проверьте правильность введенных данных.")}).finally(()=>{a(C),i(V,!1,"Создание")})};h.addEventListener("submit",Ue);f.addEventListener("submit",$e);y.addEventListener("submit",Fe);ge.addEventListener("submit",Te);be.addEventListener("click",()=>{ee.value=U.textContent,te.value=F.textContent,M(h,p),x(p),m(B)});$.addEventListener("click",()=>{y.reset(),M(y,p),x(p),m(q)});ke.addEventListener("click",()=>{f.reset(),M(f,p),x(p),m(C)});const De=document.querySelectorAll(".popup");De.forEach(e=>{Y(e)});Y(_);Promise.all([K(),ie()]).then(([e,t])=>{v=t._id,U.textContent=t.name,F.textContent=t.about,$.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{const r=o.likes.some(n=>n._id===v);Z.append(Q(r,o,v,{onPreviewPicture:se,onLikeIcon:re,onDeleteCard:ne,onInfoClick:oe}))})}).catch(e=>{console.log(e)});
